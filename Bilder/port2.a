!to "port2.prg", cbm

!src "rt_macros.a"
!src "rti_macros.a"

*=$C000

            jmp SHOW_IMAGE

HIDE_IMAGE  +RESET_IRQ
            lda #8
            sta $D016
            lda #32
            ldy #11
-           sta 1064,y
            sta 1104,y
            sta 1144,y
            sta 1184,y
            sta 1224,y
            sta 1264,y
            sta 1304,y
            sta 1344,y
            sta 1384,y
            sta 1424,y
            sta 1464,y
            dey
            bne -
            rts

SHOW_IMAGE  sei
            lda $01
            and #%11111110
            sta $01
            ;+COPY_CHAR_ROM $D000, $2000
            +COPY_DATA CHAR_DATA, CHAR_DATA_END, $2400
            +COPY_DATA SPRITE_DATA, SPRITE_DATA_END, $2800
            +RLINE 70
            lda #$0
            sta $D021

            lda $D018
            and #%11110001
            ora #%00001000
            sta $D018

            +INIT_IRQ irq, 22
            +COPY_CHAR CHAR, 1065, CHAR_COL, 55337
            lda $01
            ora #%00000001
            sta $01

            rts

COPY        +COPY

irq:        +START_IRQ

            +SYNC 27

            lda $D016
            sta B_CHAR_MC
            lda CHAR_MC
            sta $D016
            lda $D022
            sta B_CHAR_COL1
            lda CHAR_COL1
            sta $D022
            lda $D023
            sta B_CHAR_COL2
            lda CHAR_COL2
            sta $D023

            ldy #$10
-           lda $D000,y
            sta B_SPRITE_POS,y
            lda SPRITE_POS,y
            sta $D000,y
            dey
            bpl -

            ldy #$09
-           lda $D025,y
            sta B_SPRITE_COL,y
            lda SPRITE_COL,y
            sta $D025,y
            dey
            bpl -

            ldy #$07
-           lda 2040,y
            sta B_SPRITEDATA,y
            dey
            bpl -
            clc
            lda #$A0
            ldy #0
-           sta 2040,Y
            iny
            adc #5
            cmp #$C8
            bne -

            lda $D017
            sta B_SPRITE_YS
            lda #0
            sta $D017
            lda $D01B
            sta B_SPRITE_BG
            lda SPRITE_BG
            sta $D01B
            lda $D01C
            sta B_SPRITE_MC
            lda SPRITE_MC
            sta $D01C
            lda $D01D
            sta B_SPRITE_XS
            lda SPRITE_XS
            sta $D01D
            lda $D015
            sta B_SPRITE_ON
            lda #255
            sta $D015

            +RLINE 52

            lda #42+21
            sta $D001
            sta $D003
            lda #43+21
            sta $D005
            sta $D007
            lda #45+21
            sta $D009
            sta $D00B
            lda #48+21
            sta $D00D
            sta $D00F

            +RLINE 58
            +WAIT 41

 +WAIT 132
 inc 2040
 inc 2041
 +WAIT 32
 lda #84
 sta 53249
 lda #84
 sta 53251
 inc 2042
 inc 2043
 +WAIT 20
 lda #85
 sta 53253
 lda #85
 sta 53255
 +WAIT 32
 inc 2044
 inc 2045
 +WAIT 32
 lda #87
 sta 53257
 lda #87
 sta 53259
 +WAIT 33
 inc 2046
 inc 2047
 +WAIT 32
 lda #90
 sta 53261
 lda #90
 sta 53263
 +WAIT 518
 inc 2040
 inc 2041
 +WAIT 32
 lda #105
 sta 53249
 lda #105
 sta 53251
 inc 2042
 inc 2043
 +WAIT 20
 lda #106
 sta 53253
 lda #106
 sta 53255
 +WAIT 32
 inc 2044
 inc 2045
 +WAIT 32
 lda #108
 sta 53257
 lda #108
 sta 53259
 +WAIT 76
 inc 2046
 inc 2047
 +WAIT 32
 lda #111
 sta 53261
 lda #111
 sta 53263
 +WAIT 518
 inc 2040
 inc 2041
 +WAIT 32
 lda #126
 sta 53249
 lda #126
 sta 53251
 inc 2042
 inc 2043
 +WAIT 20
 lda #127
 sta 53253
 lda #127
 sta 53255
 inc 2044
 inc 2045
 +WAIT 21
 lda #129
 sta 53257
 lda #129
 sta 53259
 +WAIT 76
 inc 2046
 inc 2047
 +WAIT 32
 lda #132
 sta 53261
 lda #132
 sta 53263
 +WAIT 518
 inc 2040
 inc 2041
 +WAIT 32
 inc 2042
 inc 2043
 +WAIT 76
 inc 2044
 inc 2045
 +WAIT 77
 inc 2046
 inc 2047

            +RLINE 147

            lda B_CHAR_MC
            sta $D016
            lda B_CHAR_COL1
            sta $D022
            lda B_CHAR_COL2
            sta $D023

            ldy #$10
-           lda B_SPRITE_POS,y
            sta $D000,y
            dey
            bpl -

            ldy #$09
-           lda B_SPRITE_COL,y
            sta $D025,y
            dey
            bpl -

            ldy #$07
-           lda B_SPRITEDATA,y
            sta 2040,y
            dey
            bpl -

            lda B_SPRITE_YS
            sta $D017
            lda B_SPRITE_BG
            sta $D01B
            lda B_SPRITE_MC
            sta $D01C
            lda B_SPRITE_XS
            sta $D01D
            lda B_SPRITE_ON
            sta $D015

            +END_IRQ

CHAR_MC     !by 8
CHAR_COL1   !by 0
CHAR_COL2   !by 0
SPRITE_POS  !by 95,42,95,42,32,43,33,43,62,45,95,45,48,48,71,48,0
SPRITE_COL  !by 11,12,14,11,6,0,0,6,15,15
SPRITE_BG   !by 44
SPRITE_MC   !by 236
SPRITE_XS   !by 0

B_CHAR_MC     !by 0
B_CHAR_COL1   !by 0
B_CHAR_COL2   !by 0
B_SPRITE_POS  !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
B_SPRITE_COL  !by 0,0,0,0,0,0,0,0,0,0
B_SPRITE_BG   !by 0
B_SPRITE_MC   !by 0
B_SPRITE_XS   !by 0
B_SPRITE_YS   !by 0
B_SPRITE_ON   !by 0
B_SPRITEDATA

*=$B3AE

CHAR        !by 128,128,128,128,128,128,128,128,128,128,128,129,129,129,129,129,129,129,129,129,129,129,130,128,128,128,128,128,128,128,128,128,128,131,128,128,128,128,150,154,128,128,128,128,132,128,137,142,147,151,155,159,128,128,128,133,134,138,143,148,152,156,160,128,128,166,128,135,139,144,149,153,157,161,128,128,167,128,136,128,128,128,128,158,128,128,128,168,128,133,140,145,145,145,145,145,145,163,169,128,128,141,128,128,128,128,128,128,164,170,128,128,136,146,128,128,128,128,162,165,171
CHAR_COL    !by 12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,6,12,12,12,12,12,12,12,12,12,12,6,12,12,11,11,11,11,12,12,12,12,6,12,12,12,12,12,12,12,12,12,12,6,6,12,12,12,12,12,12,12,12,6,6,6,12,12,12,12,12,12,12,12,6,6,6,12,12,12,12,12,12,12,12,6,6,6,6,12,12,12,12,12,12,6,6
CHAR_DATA   !by 255,255,255,255,255,255,255,255,0,0,255,255,255,255,255,255,255,255,127,127,255,191,191,223,95,95,111,47,63,55,23,31,224,240,240,240,248,248,252,252,252,254,254,254,255,255,255,255,255,127,127,191,191,191,223,95,95,111,47,63,55,23,31,27,240,240,240,248,248,248,252,252,239,239,247,251,253,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,254,241,255,255,127,127,191,191,191,192,223,127,111,111,63,55,55,31,27,27,255,255,255,255,255,255,254,0,0,31,16,16,24,8,12,7,128,192,192,63,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,127,127,255,255,191,191,127,63,0,0,0,255,1,1,3,2,6,252,0,0,0,222,239,239,239,255,255,255,255,255,251,251,251,252,251,247,247,244,192,0,0,0,0,255,128,128,192,64,96,63,0,0,1,62,254,255,255,255,255,255,255,255,255,255,127,255,255,255,31,255,127,63,31,0,0,248,8,8,24,16,48,224,15,15,255,255,255,127,191,191,79,255,255,255,255,255,255,255,255,255,239,239,239,223,63,255,255,255,255,255,255,255,125,147,239,239,239,247,255,255,255,255,255,254,254,255,253,255,251,250,254,255,253,253,251,3,246,246,252,236,248,216,240,176,160,96,31,63,63,127,127,255,252,243,255,255,255,255,255,255,254,254,253,253,251,251,254,246,252,236,7,7,15,15,15,31,29,61,59,119,119,239,223,223,191,127,127,255,255,255,255,255,255,255,255,255,249,247,207,63,255,255
CHAR_DATA_END
SPRITE_DATA !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,2,0,0,4,0,0,4,0,0,8,0,0,0,16,0,0,16,0,0,32,0,0,64,0,0,64,0,0,128,0,1,0,0,1,0,0,2,0,0,4,0,0,4,0,0,8,0,0,0,0,0,0,0,0,0,3,0,0,4,0,0,24,0,0,96,0,1,128,0,6,0,0,0,0,0
            !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,2,0,0,2,0,0,0,0,0,4,0,0,0,0,0,8,0,0,0,0,0,16,0,0,16,0,0,32,0,0,32,0,0,64,0,0,64,0,0,0,0,0,128,0,0,0,0,1,0,0,1,0,0,0,2,0,255,254,0,0,4,0,0,4,0,0,0,0,0,8,0,0,0,0,0,16,0,0,0,0,0,32,0,0,32,0,0,64,0,0,64,0,0,128,0,0,128,0,0,0,0,1,0,0,0,0,0,2,0,0,2,0,0,0,0,0,0
            !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,85,85,85,85,85,85,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,127,255,255,127,255,255,255,255,255,127,255,255,127,255,255,223,255,255,159,255,255,159,255,255,159,255,255,0,159,255,255,191,255,255,183,255,255,167,255,255,175,255,255,179,255,207,163,255,207,175,255,243,172,255,243,172,255,252,175,255,252,168,255,252,168,255,252,171,255,252,171,127,255,171,127,255,171,127,255,170,127,255,170,127,255,170,223,255,170,159,255,0,170,159,255,170,159,255,170,159,255,170,191,255,170,183,252,170,167,240,170,175,255,170,167,255,170,163,255,170,175,255,170,172,255,170,172,255,170,175,255,170,172,255,170,168,255,170,171,255,170,171,127,170,171,127,170,171,127,170,171,127,170,170,127,0,170,170,213,170,170,223,170,170,191,170,170,159,170,170,159,170,170,191,170,170,183,170,170,183,170,170,175,170,170,167,170,170,167,170,170,175,170,170,172,170,170,172,170,170,175,170,170,172,170,170,172,170,170,171,170,170,171,0,0,0,0,0,0,0
            !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,85,85,85,85,85,85,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,63,255,255,63,255,255,55,255,239,55,255,239,63,255,239,55,255,251,7,255,251,15,255,251,13,255,251,13,255,254,15,255,254,3,255,254,3,255,254,3,255,254,3,255,254,3,255,255,3,255,255,0,255,255,0,0,255,255,0,255,255,0,255,255,0,255,254,0,255,254,0,63,235,0,63,255,0,63,255,0,55,255,0,63,255,0,55,255,0,7,255,0,15,255,0,13,255,0,13,255,0,15,255,0,15,255,0,3,255,0,3,255,0,3,255,0,3,255,0,0,3,213,0,3,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,63,0,0,63,0,0,63,0,0,63,0,0,55,0,0,55,0,0,15,0,0,13,0,0,13,0,0,13,0,0,13,0,0,0,0,0,0,0
            !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,32,0,0,192,0,1,0,0,2,0,16,2,56,16,2,192,32,15,224,48,63,240,127,255,248,255,255,255,255,255,255,0,0,1,255,159,253,85,154,173,255,15,249,171,109,91,254,103,243,0,240,6,255,255,252,255,255,252,0,255,255,128,8,112,64,4,0,64,4,0,32,4,0,16,0,0,16,0,0,44,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
            !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,85,85,85,85,85,85,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,254,255,255,254,255,255,254,255,255,254,255,255,254,255,255,254,255,255,250,255,255,250,255,255,250,255,255,250,255,255,234,255,255,234,255,255,234,255,255,234,85,87,234,255,255,170,0,255,255,170,255,254,170,255,254,170,255,254,170,255,254,170,255,250,170,255,254,170,255,250,170,255,250,170,255,250,170,255,250,170,255,250,168,255,234,170,255,234,170,255,234,170,255,234,170,255,170,170,0,0,0,0,0,0,0,0,0,0,0,0,0
            !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,85,85,85,85,85,85,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,63,255,255,0,255,0,0,255,0,0,255,5,85,255,0,1,255,2,169,255,0,1,255,2,161,255,4,5,255,1,84,255,0,0,255,192,0,255,192,0,255,63,255,255,255,255,0,243,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,213,85,85,255,255,255,255,255,255,255,255,255,255,255,255,0,63,255,255,63,255,255,63,255,255,63,255,255,63,255,255,63,255,255,15,255,255,15,255,255,15,255,255,15,255,255,15,255,255,15,255,255,3,255,255,3,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
            !by 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,85,85,85,85,85,85,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,207,243,255,255,243,240,63,243,192,63,207,0,15,15,0,0,63,0,3,255,85,87,255,64,7,255,74,167,255,80,7,255,26,135,255,16,20,60,21,83,192,0,15,243,0,15,243,0,255,243,63,255,243,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,85,85,85,255,255,255,255,255,255,255,255,255,255,255,255,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
SPRITE_DATA_END
